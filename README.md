# GO Reverse Proxy · 多路由反向代理服务

基于 Go 标准库构建的轻量级反向代理工具，编译后生成单一可执行文件，无需额外运行时依赖，开箱即用。专为本地开发调试、局域网服务代理、多后端聚合网关等场景优化设计。

## 核心特性

- 🚀 单文件部署 - 编译后仅一个可执行文件，跨平台原生运行（Windows/Linux/macOS）
- ⚡ 配置热加载 - 修改 proxy.ini 后自动平滑重启生效，服务零中断
- 🔄 多路由转发 - 支持基于路径前缀的多目标服务智能路由
- 🎯 灵活匹配模式 - 支持前缀匹配、完整正则匹配、泛型代理三种路由策略
- 📊 实时状态监控 - 内置 /status 接口，提供运行指标、流量统计与配置状态
- 🛡️ 稳健容错 - 统一 JSON 格式错误响应，内置 panic 恢复机制与请求大小限制
- 🖥️ 可视化界面 - 启动时自动打印彩色路由表和系统信息，运行状态一目了然

## 快速开始

### 环境初始化（仅首次需要）

```bash
go mod init proxy
go mod tidy  # 自动下载 fsnotify 依赖库
```

### 直接运行

> 首次运行将自动创建默认配置文件 proxy.ini，默认监听 4288 端口，包含完整的示例路由规则。

```bash
go run main.go
```

### 编译为生产环境可执行文件

Windows

```bash
go build -ldflags "-s -w" -o RevProxy_1.x.x.exe
```

Linux / Mac：

```bash
go build -ldflags "-s -w" -o revproxy
```

### 可选：添加应用图标（Windows）

使用在线图标转换工具生成 ICO 文件：https://d1tools.com/tools/ico-generator/

```bash
rsrc -ico icon.ico -arch amd64 -o rsrc.syso
```

## 配置文件详解 (proxy.ini)

配置文件结构

- 端口配置：文件中首次出现的纯数字将被识别为监听端口（位置灵活）
- 路由规则：每行定义一条路由规则，格式统一
- 注释支持：空行或 # 开头的内容作为注释被忽略

路由规则语法

```text
路径规则   后端服务地址   [匹配类型]
```

支持三种匹配模式

| 模式          | 说明       | 示例                      | 匹配行为                              |
| ----------- | -------- | ----------------------- | --------------------------------- |
| **prefix**  | 前缀匹配（默认） | `/api`                  | 匹配 `/api`、`/api/user` 等，移除路径前缀后转发 |
| **regex**   | **正则匹配** | `^/v[0-9]+/user/(\d+)$` | 使用完整正则引擎匹配，支持捕获组 `$1/$2` 替换目标路径   |
| **generic** | 泛型代理（兜底） | `*`                     | 匹配所有未匹配的请求，建议作为最后一条规则             |

### 配置示例

```ini
# 服务监听端口（配置文件中首次出现的纯数字）
4288

# 路由规则格式：路径前缀  目标地址  [匹配类型]
/api           127.0.0.1:3000
/MFP62         192.168.0.100
^/v[0-9]/.*$   127.0.0.1:3001  regex
/printer       192.168.0.101   generic
```

### 高级路由功能 (v1.0.5+)

> 正则路由与捕获组替换
> 
> 利用正则表达式的强大匹配能力，实现精细化路由控制：

```ini
# 用户信息路由：/v1/user/123 → http://127.0.0.1:3001/user/123
^/v1/user/(\d+)$    http://127.0.0.1:3001/user/$1    regex

# 订单服务路由：/api/v2/order/456 → http://127.0.0.1:3002/order/456  
^/api/v2/order/(\d+)$    http://127.0.0.1:3002/order/$1    regex

# 静态资源代理：/files/docs/report.pdf → http://192.168.1.100/static/docs/report.pdf
^/files/(.+)$    http://192.168.1.100/static/$1    regex
```

规则说明：

- 捕获组：() 内内容作为捕获组，$1 引用第一个组，$2 引用第二个，依此类推
- 完整匹配：$0 代表正则表达式匹配的完整路径
- 替换范围：模板替换仅作用于目标地址的路径部分，协议和主机名保持不变
- 安全防护：引用超出捕获组数量的 $n 将自动替换为空字符串，避免运行时错误
